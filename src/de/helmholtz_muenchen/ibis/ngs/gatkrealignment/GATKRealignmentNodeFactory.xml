<?xml version="1.0" encoding="UTF-8"?>
<knimeNode icon="./icon_d_green.png" type="Source" xmlns="http://knime.org/node/v2.8" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://knime.org/node/v2.8 http://knime.org/node/v2.8.xsd">
    <name>GATKRealignment</name>
    
    <shortDescription>
        Realignment around insertions and deletions.
    </shortDescription>
    
    <fullDescription>
        <intro>
        	This is a wrapper node for RealignerTargetCreator and the IndelRealigner walker of the Genome Analysis Toolkit (GATK). 
        	The aim of the node is to perform a realignment around putative insertions and deletions in a BAM file to reduce mapping errors and to avoid false positive variant calls.
        	This is achieved in two steps. 
        	First, the RealignerTargetCreator walker generates a list of candidate regions for realignment.
        	In the second step the IndelRealigner performs the realignment for all candidate regions. 
        	To increase the accuracy of realignment both walkers can be provided with sites of known indels.
			For further information, see the GATK documentation of the <a href="https://www.broadinstitute.org/gatk/guide/tooldocs/org_broadinstitute_gatk_tools_walkers_indels_RealignerTargetCreator.php">RealignerTargetCreator</a> and
			the <a href="https://www.broadinstitute.org/gatk/guide/tooldocs/org_broadinstitute_gatk_tools_walkers_indels_IndelRealigner.php">IndelRealigner</a>.
    	</intro>
        
        <tab name="Options">
            <option name="Sets of known indels">
            	By choosing to support the realignment with a site of known indels (indels from 1000 Genomes project or Mills and 1000 Genomes gold standard indel set) you increase the realignment accuracy. 
            	File paths can be set via the preference page.
        	</option>
            <option name="Interval for realignment">
            	You can check this option to perform realignment in certain genomic regions. 
            	You have to specify the intervals in a text file in BED format (Format explained at <a href="http://genome.ucsc.edu/FAQ/FAQformat.html"> http://genome.ucsc.edu/FAQ/FAQformat.html </a>) and select the file in the file browser.
        	</option>
            <option name="Number of threads">
            	Increasing the number of threads speeds up the node, but also increases the memory required for the calculations.
            	Only the RealignerTargetCreator tool can be run in multi-threaded mode.
        	</option>
        	<option name="Java Memory in GB">
        		Set the maximum Java heap size per thread.
        	</option>
        </tab>
        
        <tab name="RealignerTargetCreator">
            <option name="Maximum length of realignment interval">
            	This option serves to limit the interval length for realignment. 
            	Note, that the realignment algorithm has quadratic complexity and therefore longer intervals heavily impact the runtime.
        	</option>
            <option name="Minimum number of reads for entropy calculations">
            	If a locus is covered by at least that many reads TargetCreator calculates an entropy value for the site.
        	</option>
            <option name="Fraction of mismatching base qualities">
            	This option refers to the minimal fraction of mismatches at a locus that is defined as high entropy. 
            	Setting this value to 0 disables the option. 
            	You should only enable this option in case of an ungapped primary alignment.
        	</option>
            <option name="Window size for clustering SNPs">
            	All SNPs and regions of high entropy are defined as cluster if they lie in the same window.
        	</option>
        	<option name="Optional flags">
        		Set additional command line flags for the RealignerTargetCreator.
        	</option>
        </tab>
        
        <tab name="IndelRealigner">
            <option name="Consensus determination model">
            	You can choose between three different models to calculate the alternate consensus sequence. 
            	USE_READS is the recommended option. 
            	This model uses known indels and the indels in the original alignment for identifying a consensus. 
            	If you have used an ungapped aligner you should select the USE_SW model. 
            	You can also determine the consensus sequence on the base of known indels only (option KNOWNS_ONLY).
        	</option>
            <option name="LOD Threshold">
            	The LOD is a measure for significance. 
            	A region with low LOD implies that realignment of the region leads only to small improvements. 
            	Therefore only regions with LOD equal or above this threshold will be realigned. 
            	The threshold makes realignment more efficient. 
            	Decreasing the threshold can be helpful when dealing with low coverage data or when searching for rare indels.
        	</option>
            <option name="Entropy threshold">
            	The entropy threshold defines the minimum fraction of mismatches that have to be present in a locus of high entropy. 
            	IndelRealigner performs only realignment on such loci with high entropy and only if the realignment reduces the overall entropy of the region.
        	</option>
            <option name="Consensus threshold">
            	This option tries to reduce the overall realignment runtime. 
            	It limits the number of mapping consensuses tried in realignment.
        	</option>
            <option name="Insert size threshold">
            	The insert size of a read pair is defined as the distance between the leftmost and the rightmost mapping position of the read edges. 
            	An extremely high insert size indicates a completely misplaced read and is likely not to represent the correct region of origin of a read.
        	</option>
            <option name="Read shift threshold">
            	This threshold refers to a maximum number of bases to shift a read during realignment. 
            	It serves to limit the overall runtime.
        	</option>
            <option name="Maximum number of reads used for consensus calculation">
            	This option aims to reduce the overall runtime. 
            	As consensus calculation for a large number of reads is costly in terms of time, all regions exceeding this threshold will not be realigned. 
            	Increase this value according to the depth of your data if you do not want to exclude regions of high coverage.
        	</option>
            <option name="Maximum number of reads for realignment">
            	This option is to limit the usage of memory. 
            	IndelRealigner has to load all reads in need of realignment of an interval into memory. 
            	If the number of reads exceeds this threshold no realignment is performed. 
            	When dealing with deep sequencing data, you can increase this value.
        	</option>
            <option name="Output">
            	ndelRealigner resets mapping position and cigar string for all realigned reads of the output BAM file. 
            	Usually, if you do not tick this option, the tool will add the original coordinates as tag. 
            	You can prevent this behaviour and reduce the size of your output BAM file by checking this option.
        	</option>
        	<option name="Optional flags">
        		Set additional command line flags for the IndelRealigner walker.
        	</option>
        </tab>
        
        <tab name="Preference page">
        	<option name="HTE">
        		Set threshold for repeated execution.
        		Only used if HTE is enabled in the preference page.
        	</option>
        	<option name="Path to GATK jar file">
        		Set the path to the GenomeAnalysisTK.jar.
        	</option>
        	<option name="Path to reference genome">
        		Set the path to the reference genome.
        	</option>
        	<option name="Path to 1000G Indels">
        		Set the path to the 1000G project indels data set.
        	</option>
        	<option name="Path to Mills">
        		Set the path to the Mills and 1000G reference data set.
        	</option>
        </tab>

    </fullDescription>
    
    <ports>
        <inPort index="0" name="Input BAM">
        	Cell 0: Path to input BAM file.
    	</inPort>
    	
        <outPort index="0" name="Output">
        	Cell 0: Path to realigned BAM file.
    	</outPort>
    </ports> 
</knimeNode>
