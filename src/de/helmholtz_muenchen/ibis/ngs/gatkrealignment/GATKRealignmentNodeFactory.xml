<?xml version="1.0" encoding="UTF-8"?>
<knimeNode icon="./icon_d_green.png" type="Source" xmlns="http://knime.org/node/v2.8" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://knime.org/node/v2.8 http://knime.org/node/v2.8.xsd">
    <name>GATKRealignment</name>
    
    <shortDescription>
        Realignment around insertions and deletions
    </shortDescription>
    
    <fullDescription>
        <intro>
        	This is a wrapper node for TargetCreator and IndelRealigner from the Genome Analysis Toolkit (GATK). 
        	It is designed for GATK version 2.8.1. 
        	The aim of the node is to perform a realignment around putative insertions and deletions in a BAM file to reduce mapping errors and to avoid false positive variant calls. This is achieved in two steps. 
        	First, the TargetCreator walker generates a list of candidate regions for realignment. In the second step IndelRealigner performs the realignment for all candidate regions. 
        	To increase the accuracy of realignment both walkers can be provided with sites of known indels.
			<br />
			Manual page of TargetCreator at <a href="http://www.broadinstitute.org/gatk/gatkdocs/org_broadinstitute_sting_gatk_walkers_indels_RealignerTargetCreator"> http://www.broadinstitute.org/gatk/gatkdocs/org_broadinstitute_sting_gatk_walkers_indels_RealignerTargetCreator </a>
			<br />
			Manual page of IndelRealigner at <a href="http://www.broadinstitute.org/gatk/gatkdocs/org_broadinstitute_sting_gatk_walkers_indels_IndelRealigner"> http://www.broadinstitute.org/gatk/gatkdocs/org_broadinstitute_sting_gatk_walkers_indels_IndelRealigner </a>
			<br />
			GATK and sites of known variants can be downloaded at <a href="http://www.broadinstitute.org/gatk/download"> http://www.broadinstitute.org/gatk/download </a>
    	</intro>
        
        <tab name="Options">
            <option name="Path to GATK jar file">
            	Set the path to the GATK executable. 
            	This option is disabled if the path is already defined in the inport.
        	</option>
            <option name="Sets of known indels">
            	By choosing to support the realignment with a site of known indels (indels from 1000 Genomes project or Mills and 1000 Genomes gold standard indel set) you increase the realignment accuracy. 
            	You do not have to select any path if the file is already defined in the inport.
        	</option>
            <option name="Interval for realignment">
            	You can check this option to perform realignment in certain genomic regions. 
            	You have to specify the intervals in a text file in BED format (Format explained at <a href="http://genome.ucsc.edu/FAQ/FAQformat.html"> http://genome.ucsc.edu/FAQ/FAQformat.html </a>) and select the file in the file browser.
        	</option>
            <option name="Number of threads">
            	Increasing the number of threads speeds up the node, but also increases the memory required for the calculations.
        	</option>
        </tab>
        
        <tab name="TargetCreator">
            <option name="Maximum length of realignment interval">
            	This option serves to limit the interval length for realignment. 
            	Note, that the realignment algorithm has quadratic complexity and therefore longer intervals heavily impact the runtime.
        	</option>
            <option name="Minimum number of reads for entropy calculations">
            	If a locus is covered by at least that many reads TargetCreator caculates an entropy value for the site.
        	</option>
            <option name="Fraction of mismatching base qualities">
            	This option refers to the minimal fraction of mismatches at a locus that is defined as high entropy. 
            	Setting this value to 0 disables the option. 
            	You should only enable this option in case of an ungapped primary alignment.
        	</option>
            <option name="Window size">
            	All SNPs and regions of high entropy are defined as cluster if they lie in the same window.
        	</option>
        </tab>
        
        <tab name="Realignment Options">
            <option name="Consensus determination model">
            	You can choose between three different models to calculate the alternate consensus sequence. 
            	USE_READS is the recommended option. 
            	This model uses known indels and the indels in the original alignment for identifying a consensus. 
            	If you have used an ungapped aligner you should select the USE_SW model. 
            	You can also determine the consensus sequence on the base of known indels only (option KNOWNS_ONLY).
        	</option>
            <option name="LOD Threshold">
            	The LOD is a measure for significance. 
            	A region with low LOD implies that realignment of the region leads only to small improvements. 
            	Therefore only regions with LOD equal or above this threshold will be realigned. 
            	The threshold makes realignment more efficient. 
            	Decreasing the threshold can be helpful when dealing with low coverage data or when searching for rare indels.
        	</option>
            <option name="Entropy threshold">
            	The entropy threshold defines the minimum fraction of mismatches that have to be present in a locus of high entropy. 
            	IndelRealigner performs only realignment on such loci with high entropy and only if the realignment reduces the overall entropy of the region.
        	</option>
            <option name="Consensus threshold">
            	This option tries to reduce the overall realignment runtime. 
            	It limits the number of mapping consensuses tried in realignment.
        	</option>
            <option name="Insert size threshold">
            	The insert size of a read pair is defined as the distance between the leftmost and the rightmost mapping position of the read edges. 
            	An extremely high insert size indicates a completely misplaced read and is likely not to represent the correct region of origin of a read.
        	</option>
            <option name="Read shift threshold">
            	This threshold refers to a maximum number of bases to shift a read during realignment. 
            	It serves to limit the overall runtime.
        	</option>
            <option name="Maximum number of reads used for consensus calculation">
            	This option aims to reduce the overall runtime. 
            	As consensus calculation for a large number of reads is costly in terms of time, all regions exceeding this threshold will not be realigned. 
            	Increase this value according to the depth of your data if you do not want to exclude regions of high coverage.
        	</option>
            <option name="Maximum number of reads for realignment">
            	This option is to limit the usage of memory. 
            	IndelRealigner has to load all reads in need of realignment of an interval into memory. 
            	If the number of reads exceeds this threshold no realignment is performed. 
            	When dealing with deep sequencing data, you can increase this value.
        	</option>
            <option name="Output">
            	ndelRealigner resets mapping position and cigar string for all realigned reads of the output BAM file. 
            	Usually, if you do not tick this option, the tool will add the original coordinates as tag. 
            	You can prevent this behaviour and reduce the size of your output BAM file by checking this option.
        	</option>
        </tab>

    </fullDescription>
    
    <ports>
        <inPort index="0" name="In-Port">
        	Cell 0: Path2BAMFile (BAM file for variant calling, it has to be indexed)
			<br />
			Cell 1: Path2SEQFile (Reference sequence used for mapping the BAM file, a sequence index and sequence dictionary are required)
    		<br />
			Cell 2 (optional): Path2GATKFile (GATK executable)
			<br />
			Cell 3 (optional): Path2phase1 (Indel set from 1000 Genomes project)
    		<br />
			Cell 4 (optional): Path2mills (Indel set from Mills and 1000 Genomes project)
    		<br />
			Cell 5 (optional): Path2dbsnp (Set of known variants from dbSNP, the node just passes the cell on to the outport)
			<br />
			The cell position does not matter. Additional columns are ignored.
    	</inPort>
    	
        <outPort index="0" name="Out-Port">
        	Cell 0: Path2BAMFile (realigned BAM file)
			<br />
    		Cell 1: Path2SEQFile    (Reference sequence used for mapping the BAM file)
    		<br />
			Cell 2: Path2GATKFile (GATK executable)
    		<br />
			Cell 3 (optional): Path2phase1 (Indel set from 1000 Genomes project, if available from inport or node options)
    		<br />
			Cell 4 (optional): Path2mills (Indel set from Mills and 1000 Genomes project, if available from inport or node options)
    		<br />
			Cell 5 (optional): Path2dbsnp (Variant set from dbSNP, this column is passed from the inport to the next node)
    		<br />
			The cell positions are not fix. If one cell is absent (because it is optional), the following cell will take its position and the other cells will move along with it.
    	</outPort>
    </ports> 
       
    <views>
        <view index="0" name=""></view>
    </views>
</knimeNode>
