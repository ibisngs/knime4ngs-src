<?xml version="1.0" encoding="UTF-8"?>
<knimeNode icon="./icon_d_green.png" type="Source" xmlns="http://knime.org/node/v2.8" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://knime.org/node/v2.10 http://knime.org/node/v2.10.xsd">
    <name>LOFSummary</name>
    
    <shortDescription>
        This node generates summary files for annotated variants.
    </shortDescription>
    
    <fullDescription>
        <intro>
        	This node generates tab separated summary files of genetic variants annotated by the Variant Effect Predictor (VEP).
        	Note, that all variants in the input VCF file are considered as LOF variants.
        	That is, the node does not implicitly filter for LOF variants!
        	Moreover, the resulting summary files are only informative if you apply the node to VCF files comprising the genotypes for each variant.
        	<ul>
        		<li>
        			The variant_summary comprises the following fields: chr, pos, rsId, ref_allele, alt_allele, AF, obs_het, obs_hom, gene_id, gene_symbol, effect, lof_trans, all_trans, consequence.
        			<br />
        			The columns obs_het and obs_hom indicate how often a variant is observed in heterozygous/homozygous state.
        			The number of transcripts affected by a LOF variant is given in column lof_trans.
        			The effect of a variant is based on the columns lof_trans and all_trans. 
        			"Full" indicates that all transcripts (all_trans) of a gene are affected by a variant.
        			The last column summarizes the annotations of LOF variants in form of triples consisting of the affected gene, the affected transcript and the annotated consequence.
        		</li>
        		<li>
        			The gene_summary comprises the following fields: gene_id, gene_symbol, aff_case, aff_ctrl, un_case, un_ctrl.
        			<br />
        			The four columns (aff_case, aff_ctrl, un_case, un_ctrl) comprise a contingency table for cases/controls (given by PED) and LOF affected/unaffected samples.
        			If no PED file is given, all samples are considered as controls.
        		</li>
        		<li>
        			The sample_summary comprises the following fields: sample, nr_aff, at_least_one_transcript_ko, nr_ko, ko_genes, affected_genes.
        			<br />
        			The number of genes affected by at least one LOF variant is given in column nr_aff.
        			The number of genes with at least one inactivated transcript is given in column at_least_one_transcript_ko.
        			A transcript can be inactivated due to homozygous LOF variants or by compound heterozygosity.
        			If all transcripts of a gene are completely inactivated, the gene is considered as a knock-out (ko). 
        			The number of ko genes per sample is given in column nr_ko, the symbols are given in the subsequent column.
        			The last column is a semi-colon separated list of LOF transcripts/genes.
        			For each affected transcript, it is annotated to what extend it is inactivated given by the levels: 
        			mat (transcripts are only maternally affected),
        			pat (analogous to mat),
        			het (analogous to mat if no phasing information is given),
        			pot_comp (two heterozygous variants affect a transcript),
        			comp (equal to compound heterozygosity),
        			hom (at least one transcript carries a homozygous variant).
        		</li>
        		<li>
        			A gene_set_summary is generated if you select a gene set file in the configuration dialog.
        			The first column contains the name of the gene set, the second one the number of assigned genes. 
        			The subsequent four columns contain a contingency table for the whole gene set. 
        			The last column shows the genes affected by LOF mutations.
        		</li>
        	</ul>
        </intro>
        
        <option name="Path to CDS/GTF files">
        	A CDS or GTF file is required to compare the number of the affected transcripts to all transcripts of a gene.
        	The Ensembl CDS or GTF file which can both be downloaded here:
        	<br />
        	<a href="http://www.ensembl.org/info/data/ftp/index.html">http://www.ensembl.org/info/data/ftp/index.html</a>
        	<br />
        	To improve the performance of the node, it uses an internal representation of the given file which is stored at the location of the original file (ending with .gene_info).
        	Uncheck this box, if you do not want to use this .gene_info file.
        </option>
        <option name="Path to PED file">
        	Select a PED file which defines the case (phenotype = 2) and the control group (phenotype = 1).
        </option>
        <option name="Path to gene set file">
        	The node is able to read gene set descriptions of the MSigDB which can be found here:
        	<br />
        	<a href="http://software.broadinstitute.org/gsea/downloads.jsp">MSigDB Downloads</a>
        	<br />
        	Note, that you have to download the "gene symbols" version of the desired data set.
        </option>
        <option name="Further options">
        	The node can be run in parallel mode which is recommended for file sizes up to 1 GB.
        	Larger files should be processed in sequential mode to prevent OutOfMemoryError exceptions.
        </option>
    </fullDescription>
    
    <ports>
        <inPort index="0" name="VCF file">
        	Cell 0: Path to VCF file.
        </inPort>
        <outPort index="0" name="Summary files">
        	Cell 0: Path to variant summary file.
        	<br />
        	Cell 1: Path to gene summary file.
        	<br />
        	Cell 2: Path to sample summary file.
        	<br />
        	Cell 3: Path to gene set summary file (only in output table if gene set file is given).
        </outPort>
    </ports>    
</knimeNode>
