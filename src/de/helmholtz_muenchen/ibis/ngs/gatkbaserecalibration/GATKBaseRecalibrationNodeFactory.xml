<?xml version="1.0" encoding="UTF-8"?>
<knimeNode icon="./icon_d_green.png" type="Source" xmlns="http://knime.org/node/v2.8" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://knime.org/node/v2.8 http://knime.org/node/v2.8.xsd">
    <name>GATKBaseRecalibration</name>
    
    <shortDescription>
        Recalibration of sequencing quality scores.
    </shortDescription>
    
    <fullDescription>
        <intro>
        	This is a wrapper node for AnalyzeCovariates, BaseRecalibrator and PrintReads of the Genome Analysis Toolkit (GATK). 
        	This node addresses the problem of systematic errors in the base quality score emitted by sequencing machines. 
        	As these base qualities are used by many variant calling tools removing the bias leads to more accurate variant calls. 
        	The process of recalibration consists of 3 steps.
			<br />
			<b>Step 1:</b> A machine learning device is trained to build a model of covariation which is generated from the actual data and from known sites of genetic variation. 
			(walkers: BaseRecalibrator)
			<br />
			<b>Step 2:</b> This optional step builds a second model and compares it to the first one. 
			The comparison allows to generate before/after plots of the quality values. 
			(walkers: BaseRecalibrator + AnalyzeCovariates).
			<br />
			<b>Step 3:</b> Finally, the model is applied to the alignment data and the base qualities are adapted to the biases found. 
			(walkers: PrintReads)
			<br />
			For further information, see the GATK documentation of the <a href="https://www.broadinstitute.org/gatk/guide/tooldocs/org_broadinstitute_gatk_tools_walkers_bqsr_BaseRecalibrator.php">BaseRecalibrator</a>,
			the <a href="https://www.broadinstitute.org/gatk/guide/tooldocs/org_broadinstitute_gatk_tools_walkers_bqsr_AnalyzeCovariates.php">AnalyzeCovariates</a> and
			the <a href="https://www.broadinstitute.org/gatk/guide/tooldocs/org_broadinstitute_gatk_tools_walkers_readutils_PrintReads.php">PrintReads</a> walkers.
    	</intro>
        
        <tab name="Options">
            <option name="Sets of known polymorphisms">
            	You have to provide the node with at least one of the three named sets: 
            	Indels from 1000 Genomes project, indels from Mills and 1000 Genomes project, variants from dbSNP. 
            	BaseRecalibrator needs the sets for training its model.
        	</option>
            <option name="Interval for recalibration">
            	You can check this option to perform recalibration in certain genomic regions. 
            	You have to specify the intervals in a text file in BED format (Format explained at <a href="http://genome.ucsc.edu/FAQ/FAQformat.html"> http://genome.ucsc.edu/FAQ/FAQformat.html </a>) and select the file in the file browser.
        	</option>
            <option name="Before/after plots">
            	Tick this option to generate before/after plots of the base quality score.
        	</option>
        	<option name="Optional flags">
        		Set additional command line flags for the AnalyzeCovariates walker.
        	</option>
        	<option name="Remove all...">
            	By ticking this option you remove all additional information from the output BAM file except the read group tag. 
            	The option reduces the output file size.
        	</option>
        	<option name="Optional flags">
        		Set additional command line flags for the PrintReads walker.
        	</option>
            <option name="Number of CPU threads">
            	Increasing the number of threads speeds up the node, but also increases the memory required for the calculations.
            	The BaseRecalibrator and the PrintReads walker run in multi-threaded mode.
        	</option>
        	<option name="Shared Java Memory">
        		Set the maximum Java heap size shared by all CPU threads.
        	</option>
        </tab>
        <tab name="BaseRecalibrator">
        	<option name="Cycle threshold">
            	This threshold applies to the cycle covariate. 
            	When BaseRecalibrator finds a greater cycle it reports an error. 
            	BaseRecalibrator ignores this value if it does not analyze cycle covariate.
        	</option>
        	<option name="Gap open penalty">
            	Gap open penalty for calculating BAQ (par-base alignment quality, probability that a base is not correctly aligned). 
            	For whole-genome data, it is recommended to use a value around 30 as gap open penalty.
        	</option>
            <option name="Calculation of covariates">
            	Select the covariates you want to analyse. 
            	Quality score covariate, read group covariate are always calculated. Context covariate and cycle covariate are optional but recommended covariates. 
            	Additionally, it is possible to examine repeat length covariate and repeat unit covariate.
        	</option>
           
            
            <option name="Default quality for insertions">
            	Set the default quality for the base insertion covariate model. 
            	To disable to the option, set this value to -1.
        	</option>
            <option name="Default quality for deletions">
            	Set the default quality for the base deletion covariate model. 
            	To disable to the option, set this value to -1.
        	</option>
            <option name="Default quality for mismatches">
            	Set the default quality for the base mismatch covariate model. 
            	To disable to the option, set this value to -1.
        	</option>
            <option name="k-mer Context size for indels">
            	Set the context size around indels to calculate the context covariate. 
            	Increasing the context size requires more memory and runtime.
        	</option>
            <option name="k-mer Context size for mismatches">
            	Set the context size around base mismatches to calculate the context covariate. 
            	Increasing the context size requires more memory and runtime.
        	</option>
            <option name="Quality threshold for read tails">
            	Beginning and end of reads often have low quality values. 
            	These values should not be considered in the context covariate. 
            	This option defines the quality value which marks the beginning of the low-quality read edges.
        	</option>
            <option name="Optional flags">
        		Set additional command line flags for the BaseRecalibrator walker.
        	</option>
        </tab>
        
        <tab name="Preference page">
        	<option name="HTE">
        		Set threshold for repeated execution.
        		Only used if HTE is enabled in the preference page.
        	</option>
        	<option name="Path to GATK jar file">
        		Set the path to the GenomeAnalysisTK.jar.
        	</option>
        	<option name="Path to reference genome">
        		Set the path to the reference genome.
        	</option>
        	<option name="Path to 1000G Indels">
        		Set the path to the 1000G project indels data set.
        	</option>
        	<option name="Path to Mills">
        		Set the path to the Mills and 1000G reference data set.
        	</option>
        	<option name="Path to dbSNP">
        		Set the path to the dbSNP reference data set.
        	</option>
        </tab>
        
    </fullDescription>
    
    <ports>
        <inPort index="0" name="Input BAM">
        	Cell 0: Path to input BAM file.
    	</inPort>
        <outPort index="0" name="Output">
        	Cell 0: Path to recalibrated BAM file.
    	</outPort>
    </ports>
</knimeNode>
